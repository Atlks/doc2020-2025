Atitit ç¼–ç¨‹è¯­è¨€æ€§èƒ½ä¼˜åŒ–æ–¹æ³•æ€»ç»“

ä¸‰å¤§æ–¹æ³• é€šè¿‡æž¶æž„  é…ç½® ä»£ç è°ƒæ•´
ä¸Šäº‘ äº‘è™šæ‹Ÿæœºæ€§èƒ½æ›´é«˜å®¹æ˜“æå‡

é…ç½®æ¨¡å¼å¯¹ä¼˜åŒ–
ä¼˜åŒ–vmé…ç½® jit gcç­‰
æŒ‡ä»¤cache  opcacheç­‰å¼€å¯
å¹¶å‘æ¨¡å¼ å¤šè¿›ç¨‹ å¤šçº¿ç¨‹æ¨¡å¼
æ¢webæœåŠ¡å™¨
ç¼–ç¨‹æ–¹æ³•ä¼˜åŒ–

ç®€åŒ– æ¶ˆé™¤å†—ä½™ä»£ç 
ç®€åŒ–ä»£ç  å‡å°‘ä¸å¿…è¦çš„æŒ‡ä»¤  åªæœ‰5%æ˜¯çœŸæ­£é‡è¦å¯¹
ä»Žæ ¹æœ¬ä¸Šè®²ï¼Œæé«˜æ•°æ®åº“æ€§èƒ½çš„æ–¹æ³•æ˜¯å‡å°‘ CPU æŒ‡ä»¤æ•°é‡ï¼›æœ‰å®žéªŒä¹‹å¤„æ•°æ®åº“å¤„ç†äº‹åŠ¡è¿‡ç¨‹ä¸­ï¼Œæ­£çœŸæœ‰ç”¨çš„æŒ‡ä»¤ï¼Œå³ç”¨äºŽäº‹åŠ¡é€»è¾‘çš„æŒ‡ä»¤ä¸åˆ°5%

ä¸ä½¿ç”¨å¤§åž‹é‡åž‹å¤–æŒ‚æ¡†æž¶ormç­‰
çš„ PHP çš„è¿ç®—æ€§èƒ½è¡¨çŽ°éƒ½å¾ˆä¼˜å¼‚ï¼Œä½†æ˜¯å—åˆ°å¤–åŠ æ¡†æž¶çš„å½±å“ï¼ŒåŽŸæœ¬å¯ä»¥åœ¨æ•°ç§’å†…å¤„ç†ä¸Šåƒä¸ªç½‘é¡µè¦æ±‚çš„ PHPï¼Œæ€§èƒ½å¤§å¹…ä¸‹é™ï¼Œå˜ä¸ºåªèƒ½å¤„ç†æ•°å ä¸ªè¦æ±‚ã€‚

ðŸ˜‚ormæ¡†æž¶å¾ˆå½±å“æ€§èƒ½å•Šï¼Œåœ¨è¿™ç±»å¤æ‚æŽ¥å£é‡Œé¢ç›´æŽ¥æ‹¼sqlå§ã€‚ã€‚æ¡†æž¶åŠ è½½å¾ˆè€—æ—¶


åµŒå…¥å…¶ä»–è¯­è¨€sqlç­‰sp  javaç­‰ä¼˜åŒ–
å°‘ç”¨è™šå‡½æ•°  å‡å°‘å¤šæ€åŠ¨æ€  å°½å¯èƒ½é™æ€æ–¹æ³•å‡½æ•°
æ–¹æ³•ä¸è¦ä»£ç å¤ªå°‘ï¼ŒåŠ å¤§å†…è”inlineä»£ç 
é€šè¿‡æ³¨é‡Šåˆ†å‰² åŠ å¼ºå¯è¯»æ€§

å°½å¯èƒ½ä½¿ç”¨stackå˜é‡ï¼Œä¸è¦ä¼ é€’å¼•ç”¨
å¯¹è±¡åºåˆ—åŒ–ä¼ é€’å¯èƒ½æ¯”åŠ è½½æ›´å¿«
æŒ‡å®šç±»åž‹  ä¼˜åŒ–objæ¨¡å¼
ä»£æ•°ç®€åŒ–
Â finalã€static åŸŸç­‰ï¼‰ï¼Œç§°ä¸ºé™æ€è§£æž
TPLå¤šä»»åŠ¡
ç¼–è¯‘å™¨ä¼˜åŒ–
Jit .JITç¼–è¯‘Â (JIT Compile)
ä½¿ç”¨æ›´å¿«å¯¹å­˜å‚¨å¯„å­˜å™¨ï¼Œä½¿ç”¨stackå˜é‡ä¼˜å…ˆ
åžƒåœ¾å›žæ”¶ç®¡ç†
3.å†…åµŒç¼“å­˜(inline cache)
å¿«ç…§
V8å¼•å…¥äº†å¿«ç…§æœºåˆ¶ï¼Œå°†å†…ç½®çš„å¯¹è±¡å’Œå‡½æ•°åŠ è½½ä¹‹åŽçš„å†…å­˜ä¿å­˜å¹¶åºåˆ—åŒ–ã€‚åºåˆ—åŒ–ä»¥åŽçš„ç»“æžœå¾ˆå®¹æ˜“ååºåˆ—åŒ–ï¼Œç»è¿‡å¿«ç…§æœºåˆ¶çš„å¯åŠ¨æ—¶é—´å¯ä»¥ç¼©å‡å‡ æ¯«ç§’ã€‚å¿«ç…§æœºåˆ¶ä¹Ÿå¯ä»¥å°†ä¸€äº›å¼€å‘è€…è®¤ä¸ºéœ€è¦çš„JSæ–‡ä»¶åºåˆ—åŒ–æ¥å‡å°‘å¤„ç†äº‹ä»¶ã€‚
å¼ºç±»åž‹æœºåˆ¶  æˆ–ç›¸åŒç±»åž‹é˜²æ­¢è§¦å‘ä¼˜åŒ– å›žæ»š
ã€‚ä¸€ä¸ªå‡½æ•°åº”è¯¥ä½¿ç”¨æ¯”è¾ƒå°‘çš„æ•°æ®ç±»åž‹ï¼›å¯¹äºŽæ•°ç»„ï¼Œåº”å°½é‡å­˜æ”¾ç›¸åŒç±»åž‹çš„æ•°æ®ï¼Œè¿™æ ·å°±å¯ä»¥é€šè¿‡åç§»ä½ç½®æ¥è®¿é—®ã€‚

other

å¤šä½¿ç”¨æ ˆå†…å­˜
æ–¹æ³•å†…è”

10.ç¼–è¯‘å™¨çš„ä¼˜åŒ–

1ï¼‰æ–¹æ³•å†…è”ä¼˜åŒ–
å†…è”ä¼˜åŒ–æ˜¯ï¼šä¸€æ˜¯åŽ»é™¤æ–¹æ³•è°ƒç”¨çš„æˆæœ¬ï¼ˆå¦‚å»ºç«‹æ ˆå¸§ç­‰ï¼‰ï¼ŒäºŒæ˜¯ä¸ºäº†å…¶ä»–ä¼˜åŒ–å»ºç«‹è‰¯å¥½çš„åŸºç¡€
æ–¹æ³•çš„è°ƒç”¨è¿‡ç¨‹ï¼š
ã€€ã€€(1)Â é¦–å…ˆä¼šæœ‰ä¸ªæ‰§è¡Œæ ˆï¼Œå­˜å‚¨ç›®å‰æ‰€æœ‰æ´»è·ƒçš„æ–¹æ³•ï¼Œä»¥åŠå®ƒä»¬çš„æœ¬åœ°å˜é‡å’Œå‚æ•°ï¼›
ã€€ã€€(2)Â å½“ä¸€ä¸ªæ–°çš„æ–¹æ³•è¢«è°ƒç”¨äº†ï¼Œä¸€ä¸ªæ–°çš„æ ˆå¸§ä¼šè¢«åŠ åˆ°å½“å‰çº¿ç¨‹çš„æ ˆé¡¶ï¼Œåˆ†é…çš„æœ¬åœ°å˜é‡å’Œå‚æ•°ä¼šå­˜å‚¨åœ¨è¿™ä¸ªæ ˆå¸§ä¸­ï¼›
ã€€ã€€(3)Â è·³åˆ°ç›®æ ‡æ–¹æ³•ä»£ç æ‰§è¡Œï¼›
ã€€ã€€(4)Â æ–¹æ³•è¿”å›žçš„æ—¶å€™ï¼Œæœ¬åœ°æ–¹æ³•å’Œå‚æ•°ä¼šè¢«é”€æ¯ï¼Œæ ˆé¡¶è¢«ç§»é™¤ï¼›
ã€€ã€€(5)Â è¿”å›žåŽŸæ¥åœ°å€æ‰§è¡Œï¼›
æ–¹æ³•å†…è”çš„åŽŸç†ï¼š
æ–¹æ³•å†…è”å°±æ˜¯æŠŠè¢«è°ƒç”¨æ–¹å‡½æ•°ä»£ç â€å¤åˆ¶â€åˆ°è°ƒç”¨æ–¹å‡½æ•°ä¸­ï¼Œæ¥å‡å°‘å› å‡½æ•°è°ƒç”¨å¼€é”€çš„æŠ€æœ¯ã€‚
ä¸€ä¸ªç®€å•çš„ä¸¤æ•°ç›¸åŠ ç¨‹åºï¼Œè¢«å†…è”å‰çš„ä»£ç ï¼š

private int add1(int a, int b, int c, int d){


      return add2(a + b) + add2(c + d);


  }


 


  private int add2(int x, int y){


      return x + y;


}

è¿è¡Œä¸€æ®µæ—¶é—´åŽJVMä¼šæŠŠadd2æ–¹æ³•åŽ»æŽ‰ï¼Œå¹¶æŠŠä½ çš„ä»£ç ç¿»è¯‘æˆï¼š

private int add1(int a, int b, int c, int d){


      return a + b + c + d;


  }

æ³¨æ„ç‚¹ï¼š
1ï¼‰æ–¹æ³•å†…è”çš„å…¶ä»–éšå«æ¡ä»¶ï¼š

è™½ç„¶JITå·ç§°å¯ä»¥é’ˆå¯¹ä»£ç å…¨å±€çš„è¿è¡Œæƒ…å†µè€Œä¼˜åŒ–ï¼Œä½†æ˜¯JITå¯¹ä¸€ä¸ªæ–¹æ³•å†…è”ä¹‹åŽï¼Œè¿˜æ˜¯å¯èƒ½å› ä¸ºæ–¹æ³•è¢«ç»§æ‰¿ï¼Œå¯¼è‡´éœ€è¦ç±»åž‹æ£€æŸ¥è€Œæ²¡æœ‰è¾¾åˆ°æ€§èƒ½çš„æ•ˆæžœ


æƒ³è¦å¯¹çƒ­ç‚¹çš„æ–¹æ³•ä½¿ç”¨ä¸Šå†…è”çš„ä¼˜åŒ–æ–¹æ³•ï¼Œæœ€å¥½å°½é‡ä½¿ç”¨finalã€privateã€staticè¿™äº›ä¿®é¥°ç¬¦ä¿®é¥°æ–¹æ³•ï¼Œé¿å…æ–¹æ³•å› ä¸ºç»§æ‰¿ï¼Œå¯¼è‡´éœ€è¦é¢å¤–çš„ç±»åž‹æ£€æŸ¥ï¼Œè€Œå‡ºçŽ°æ•ˆæžœä¸å¥½æƒ…å†µã€‚


2ï¼‰å…¬å…±å­è¡¨è¾¾å¼æ¶ˆé™¤ ä¸Ž  ä»£æ•°ç®€åŒ–
ï¼‰ä»£ç è¿›å…¥å³æ—¶ç¼–è¯‘å™¨JITä¸­ï¼š
ã€€ã€€int d = E * 12 + a + (a + E);
3) è¿™æ—¶å³æ—¶ç¼–è¯‘å™¨æœ‰å¯èƒ½è¿›è¡Œå¦å¤–ä¸€ç§ä¼˜åŒ–ï¼šä»£æ•°ç®€åŒ–
ã€€ã€€int d = E * 13 + a * 2;

3ï¼‰ æ•°ç»„è¾¹ç•Œæ£€æŸ¥æ¶ˆé™¤
Javaè¯­è¨€æ˜¯ä¸€é—¨åŠ¨æ€å®‰å…¨çš„è¯­è¨€ã€‚å¦‚æžœæœ‰ä¸€ä¸ªæ•°ç»„foo[]ï¼Œåœ¨Javaè¯­è¨€ä¸­è®¿é—®æ•°ç»„å…ƒç´ foo[i]çš„æ—¶å€™ç³»ç»Ÿå°†ä¼šè‡ªåŠ¨è¿›è¡Œä¸Šä¸‹ç•Œçš„èŒƒå›´æ£€æŸ¥ï¼Œå³æ£€æŸ¥iå¿…é¡»æ»¡è¶³i >=0 && i < foo.lengthè¿™ä¸ªæ¡ä»¶ï¼Œå¦åˆ™å°†æŠ›å‡ºä¸€ä¸ªè¿è¡Œæ—¶å¼‚å¸¸ï¼šjava.lang.ArrayIndexOutOfBoundsExceptionã€‚
æ— è®ºå¦‚ä½•ï¼Œä¸ºäº†å®‰å…¨ï¼Œæ•°ç»„ä¾¿æ·æ£€æŸ¥è‚¯å®šæ˜¯å¿…é¡»åšçš„ï¼Œä½†æ•°ç»„è¾¹ç•Œæ£€æŸ¥æ˜¯ä¸æ˜¯å¿…é¡»åœ¨è¿è¡ŒæœŸé—´ä¸€æ¬¡ä¸æ¼çš„æ£€æŸ¥åˆ™æ˜¯å¯ä»¥â€œå•†é‡â€çš„äº‹æƒ…ã€‚ä¾‹å¦‚ï¼šæ•°ç»„ä¸‹æ ‡æ˜¯ä¸€ä¸ªå¸¸é‡ï¼Œå¦‚ foo[3]ï¼Œåªè¦åœ¨ç¼–è¯‘æœŸæ ¹æ®æ•°æ®æµåˆ†æžæ¥ç¡®å®šfoo.lengthçš„å€¼ï¼Œå¹¶åˆ¤æ–­ä¸‹æ ‡â€œ3â€æ²¡æœ‰è¶Šç•Œï¼Œæ‰§è¡Œçš„æ—¶å€™å°±æ— éœ€åˆ¤æ–­äº†

4ï¼‰é€ƒé€¸åˆ†æž

é€ƒé€¸åˆ†æžçš„åŸºæœ¬è¡Œä¸ºå°±æ˜¯åˆ†æžå¯¹è±¡åŠ¨æ€ä½œç”¨åŸŸï¼šå½“ä¸€ä¸ªå¯¹è±¡åœ¨æ–¹æ³•ä¸­è¢«å®šä»¥åŽï¼Œå®ƒå¯èƒ½è¢«å¤–éƒ¨æ–¹æ³•æ‰€å¼•ç”¨ï¼Œä¾‹å¦‚ä½œä¸ºè°ƒç”¨å‚æ•°ä¼ é€’åˆ°å…¶ä»–æ–¹æ³•ä¸­ï¼Œç§°ä¸ºæ–¹æ³•é€ƒé€¸ã€‚ç”šè‡³è¿˜æœ‰å…¶å¯èƒ½è¢«å¤–éƒ¨çº¿ç¨‹è®¿é—®åˆ°ï¼Œè­¬å¦‚èµ‹å€¼ç»™ç±»å˜é‡æˆ–å¯ä»¥åœ¨å…¶ä»–çº¿ç¨‹ä¸­è®¿é—®çš„å®žä¾‹å˜é‡ï¼Œç§°ä¸ºçº¿ç¨‹é€ƒé€¸ï¼
Javaå¯¹ä¼˜åŒ–æ–¹æ³•
C1 å’Œ C2 ç¼–è¯‘å™¨
åˆ†å±‚ç¼–è¯‘æŠ€æœ¯

Node v8å¼•æ“Žä¼˜åŒ–
éšè—ç±»

Php7å¯¹æ€§èƒ½ä¼˜åŒ–
ä¸ºä»€ä¹ˆPHP7çš„æ€§èƒ½å¯ä»¥æé«˜è¿™ä¹ˆå¤šï¼Ÿ
1. JIT
2. Zvalçš„æ”¹å˜
3. å†…éƒ¨ç±»åž‹zend_string
4. PHPæ•°ç»„çš„å˜åŒ–ï¼ˆHashTableå’ŒZend Arrayï¼‰
5. å‡½æ•°è°ƒç”¨æœºåˆ¶ï¼ˆFunction Calling Conventionï¼‰
6. é€šè¿‡å®å®šä¹‰å’Œå†…è”å‡½æ•°ï¼ˆinlineï¼‰ï¼Œè®©ç¼–è¯‘å™¨æå‰å®Œæˆéƒ¨åˆ†å·¥ä½œ


PHP7æ€§èƒ½æå‡åŽŸå› æ€»ç»“ï¼š
1ã€å­˜å‚¨å˜é‡çš„ç»“æž„ä½“å˜å°ï¼Œå°½é‡ä½¿ç»“æž„ä½“é‡Œæˆå‘˜å…±ç”¨å†…å­˜ç©ºé—´ï¼Œå‡å°‘å¼•ç”¨ï¼Œè¿™æ ·å†…å­˜å ç”¨é™ä½Žï¼Œå˜é‡çš„æ“ä½œé€Ÿåº¦å¾—åˆ°æå‡ã€‚
2ã€å­—ç¬¦ä¸²ç»“æž„ä½“çš„æ”¹å˜ï¼Œå­—ç¬¦ä¸²ä¿¡æ¯å’Œæ•°æ®æœ¬èº«åŽŸæ¥æ˜¯åˆ†æˆä¸¤ä¸ªç‹¬ç«‹å†…å­˜å—å­˜æ”¾ï¼Œphp7å°½é‡å°†å®ƒä»¬å­˜å…¥åŒä¸€å—å†…å­˜ï¼Œæå‡äº†cpuç¼“å­˜å‘½ä¸­çŽ‡ã€‚
3ã€æ•°ç»„ç»“æž„çš„æ”¹å˜ï¼Œæ•°ç»„å…ƒç´ å’Œhashæ˜ å°„è¡¨åœ¨php5ä¸­ä¼šå­˜å…¥å¤šä¸ªå†…å­˜å—ï¼Œphp7å°½é‡å°†å®ƒä»¬åˆ†é…åœ¨åŒä¸€å—å†…å­˜é‡Œï¼Œé™ä½Žäº†å†…å­˜å ç”¨ã€æå‡äº†cpuç¼“å­˜å‘½ä¸­çŽ‡ã€‚
4ã€æ”¹è¿›äº†å‡½æ•°çš„è°ƒç”¨æœºåˆ¶ï¼Œé€šè¿‡å¯¹å‚æ•°ä¼ é€’çŽ¯èŠ‚çš„ä¼˜åŒ–ï¼Œå‡å°‘ä¸€äº›æŒ‡ä»¤æ“ä½œï¼Œæé«˜äº†æ‰§è¡Œæ•ˆçŽ‡ã€‚
ref


Javaæ€§èƒ½ä¼˜åŒ–ç³»åˆ—ä¹‹-JITå³æ—¶ç¼–è¯‘å™¨ä¸ŽJavaå†…å­˜ç®¡ç†æœºåˆ¶_mike_junçš„åšå®¢-CSDNåšå®¢

ä¸ºä»€ä¹ˆV8å¼•æ“Žè¿™ä¹ˆå¿«ï¼Ÿ-é˜¿é‡Œäº‘å¼€å‘è€…ç¤¾
V8å¸¦æ¥çš„JSæ€§èƒ½ä¼˜åŒ– - äº‘+ç¤¾åŒº - è…¾è®¯äº‘åŒº
PHPå°ç™½è¦çŸ¥é“ï¼šPHP7 æ€§èƒ½ä¸ºä½•èƒ½ç¿»å€çš„å…³é”®å› ç´ æ˜¯ä»€ä¹ˆ - äº‘+ç¤¾åŒº - è…¾è®¯äº‘
