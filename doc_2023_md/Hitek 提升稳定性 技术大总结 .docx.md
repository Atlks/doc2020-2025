Hitek 提升稳定性 可靠性 v2



看看可否有稳定性搞得lib
全面实施稳定性增强api计划，开发搞稳定性api
Try catch
全局err钩子增加
Try catch大发  
Try+定时 熔断模式
Try降级模式
框架tp trycatch
全面try catch  保证主流程 故障恢复模式
基本for都要trycatch 增强全局稳定性


Aop 可以应用在log ex抓取 retry http上
接口超时时间 一定要设置  net模式
增加nullsafe调用模式

尽可能全面判空等判断
日志log记得也要trycvatch 防止权限不足无法写入err
http bot 需要retry模式
Try catch 局部不重要功能。。故障了也不影响使用
局部功能，以保证整体服务的可用性；
具体实施aop条例

callfun模式动态代理很重要
http sql 等重要基础库api也可静态植入
http db file cmd shell  等io库 dsl重要的lib 增加安全稳定性api包装
也可直接包装callfun模式来调用
对于业务dsl fun接口使用callfun模式包装调用
稳定性设计
Loc模式代替net模式   
多库db模式取代高性能远程模式
针对用户分库。。每个用户一个库。。甚至多个库，在根据业务时间分库。。
总用户查询，可以使用双写模式，以及统计使用mgdb模式总后台给他使用。。
功能开关  及时关闭不必要的功能错误功能
隔离设计  try catch隔离代码，进程隔离，存储隔离防止互相影响。。
本地loc db 多库模式隔离
存储使用json文档本地数据库，防止网络http不良连接
全面尽可能采用local模式，杜绝net问题
热部署模式  防止停机模式  cli重新启动
定时释放资源，防止conn泄露  mem泄露
double check必要的时候
核心路径流程提升，确保任何突发情况主流程不能受影响
接口单一职责性：对于核心功能的接口
，不应该过多的耦合不属于它的功能。如果一个接口做的事情太多应做拆分，保证单接口的稳定性和快速响应；

第三方服务隔离性：
任何依赖于第三方的服务（不论接口还是中间件等），都应该做到熔断和降级，不能有强耦合的依赖；

主循环与 单个使用cli连接，稳定性增强，防止主循环出问题
基本for都要trycatch
文件名附加rdm tag，防止单点故障
尽可能无所模式，要加所，使用定时所释放模式

################针对具体对象的稳定性
进程稳定性 守护进程 
多单元部署运行微服务
主进程for循环 cli隔离模式
锁检测与定时释放模式

日志权限进程
日志清理进程  
服务监控   warning日志err日志挖掘
每个服务应该做好对应的监控工作，如有异常应及时响应，不应累积。


适当多单元部署运行微服务
多进程 vs 多现成模式
同一份代码，多增加微服务进程即可 多进程模式

存储稳定性Db稳定性 数据所
针对db做断线 重连机制。。
去除db后的基本可读模式稳定性
Loc db更加稳定可靠，基本不存在断线问题
多种db  ，是否可以nosql模式
细粒度事务模式，ver版本无所比较模式
必要的时候自己的3gl代码实现事务
及时释放conn防止资源泄露
资源增加资源锁，现获取资源然后操作，防止多服务重复操作
Task文件先移动然后读取操作
数据库可以增加标识，然后操作 ver比较

Net 接口稳定性
http bot接口 reset   ，db socket
全部加retry 模式和timer定时超时模式
及时释放db conn

############## 流程提升稳定性

单元测试
如果不通过则err抛出  aersset断言模式
压测机制：压测是高并发稳定性的试金石
，能提前预知高并发来临时，系统应该出现的模样；


5.流程规范
备份 code db 。。
Git打tag写说明  gitflow分支管理起来
部署流程操作手册说明文档和
部署结果日志


3. 灰度测试 小范围试错，尽量发现问题
灰度目的是小范围试错，尽量发现问题。灰度的策略大概有以下几种，
地区模式灰度
第一个策略是只让某一个地区的人先访问最新的特性，遇到问题的话用户及时反馈，问题也只会影响特定地区。另外一个策略是
基于用户属性，新老用户
如一个推荐系统，请求过来的时候能区分新老用户，它对新老用户的推荐的策略可能是不一样的，从而来验证策略的准确性和有效性。第三种策略是
基于数据，测试用户 test模式 特定用户才能测试特定功能
从一批用户中选取几个用户进行处理


最后是基于平台，app web ios等先上线一个平台 增设平台开关
一般都发生在客户端场景下。客户端与服务端不同，服务端一般是针对这个平台，先指挥这个平台先发布新版本，反馈不错再推到整个全面平台。

监控与报警  
日志监控
多加wartning 对timeout 和err
报警  bot报警模式
